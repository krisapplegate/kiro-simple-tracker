name: Simple Tests

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]

jobs:
  test:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
    
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
    
    - name: Install dependencies
      run: npm ci
    
    - name: Check if test files exist
      run: |
        echo "Checking test directory structure..."
        ls -la tests/ || echo "No tests directory"
        ls -la tests/unit/ || echo "No unit tests directory"
        ls -la tests/integration/ || echo "No integration tests directory"
        
        echo "Checking test configuration files..."
        ls -la tests/vitest.config.js || echo "No vitest config"
        ls -la tests/playwright.config.js || echo "No playwright config"
    
    - name: Check package.json scripts
      run: |
        echo "Available npm scripts:"
        npm run | grep test || echo "No test scripts found"
    
    - name: Try to run unit tests
      run: |
        echo "Attempting to run unit tests..."
        npm run test:unit || {
          echo "Unit tests failed, checking what went wrong..."
          echo "Node version: $(node --version)"
          echo "NPM version: $(npm --version)"
          echo "Current directory: $(pwd)"
          echo "Files in current directory:"
          ls -la
          exit 1
        }
    
    - name: Check syntax of key files
      run: |
        echo "Checking JavaScript syntax..."
        find . -name "*.js" -not -path "./node_modules/*" -not -path "./coverage/*" -exec echo "Checking: {}" \; -exec node -c {} \;
        echo "âœ… All JavaScript files have valid syntax"
    
    - name: Run security audit
      run: npm audit --audit-level moderate
      continue-on-error: true